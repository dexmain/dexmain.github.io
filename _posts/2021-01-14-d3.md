---
title: ssh 파일 전송 (Permission denied 오류 등)
categories: [dev]
comments: true
---

## 로컬 서버에 있는 파일을 원격 서버로 이동시키는 과정
scp dexmain/httpd-2.4.4-win64-VS16/Apache24/htdocs ubuntu@-.--.---.--:/home/<br>

## 오류 발생
Permission denied (publickey)<br><br>
※ sshd_config 파일을 수정해야한다고 한다.<br><br>

## 명령어 실행 (ssh 접속 후)
vi /etc/ssh/sshd_config <br>
또는 nano /etc/ssh/sshd_config<br>
※ /etc/ssh/sshd_config : openssh server 설치 당시<br> default로 지정된 경로인 듯 하다.<br>

## 행 수정
PasswordAuthentication no -> yes<br>
#PermitRootLogin prohibit-password -> # 제거 후 yes<br>

## ssh 재접속
sudo service ssh restart<br>

## 재시도 후 또 다른 오류 발생
ssh: connect to host -.--.---.-- port 22: Connection refused<br>
lost connection<br>

## 오류 원인 정리
1. ssh service 가 정상적으로 작동하지 않음
2. 잘못된 실행 정보 (호스트, 사용자, 암호, 포트)
3. 사용하려는 포트 닫힘
4. ssh 미설치
5. 방화벽으로 인한 ssh연결 차단

## 찾아낸 방법들 시도
nano /etc/ssh/sshd_config <br>
#port 22 -> # 제거<br>
sudo service ssh restart <br>
실패<br>

## sudo lsof -i -n -P | grep LISTEN 명령어로 수신포트 확인
22번 포트가 보이지 않는다.

## ssh 접속 불가
ssh 서버 접속불가<br>어디서부터 잘못된 것일까?
맨 처음이 화근이였다.<br>
scp로 파일이동시키는 명령어를 로컬서버에서<br>
사용했어야 했는 데 원격지에서 시도했다.<br>
그로 인한 오류가 발생했고<br>
그 것을 수정하려고 엄한 것을 건드렸던 것이다.<br>
그래서 결국 지금은 aws 인스턴스 종료 후<br>
새로운 인스턴스를 생성했다.<br>

## Permission denied (publickey)
로컬서버에서 scp를 사용해도 똑같은 오류 발생<br>
해결법을 찾아야한다.

## scp -i
scp -i c:/dexmain/key/dexy.pem prac.php ubuntu@--.--.---.--:/home/<br>
를 사용하니 <br>
scp: /home/prac.php: Permission denied<br>
라는 문구가 등장<br>
경로를 보니 원격서버에 권한 설정이 필요한듯<br>

## ubuntu 대신 root 계정으로 전송 시도
scp -i c:/dexmain/key/dexy.pem prac.php root@--.--.---.--:/home/<br>
please login as the user ubuntu rather than the user root<br>
라는 문구를 반환<br>

## root 계정을 사용할 수 있도록 설정
1. ubuntu 계정으로 ssh 접속 <br>
2. root 계정 암호 설정 $su passwd root 2 회 입력<br>
3. $ vi /etc/ssh/sshd_config<br>
4. #PermitRootLogin prohibit-password ->PermitRootLogin yes 로 수정 저장 후 종료 :qw<br>
5. $ vi /root/.ssh/authorized_keys<br>
6. no-port-forwarding ~ ssh-lsa 전까지 삭제
저장 후 종료<br>
7. ssh 재시작<br><br>

## root 계정 접속
위 방법으로 접속이 가능했고 이제 로컬서버에서<br>
파일전송도 root계정으로 가능할 것이라 생각이 들었다<br>

## 원격지로 파일전송 성공
로컬서버 파일들을 원격지로 전송에 성공했다.